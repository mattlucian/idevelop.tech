name: Lighthouse CI

on:
  pull_request:
    branches: [develop, main]
  push:
    branches: [develop, main]

jobs:
  lighthouse:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Build site
        run: cd packages/web && npm run build

      - name: Run Lighthouse CI
        uses: treosh/lighthouse-ci-action@v10
        with:
          urls: |
            http://localhost:3000/
            http://localhost:3000/hire-me
            http://localhost:3000/tech
          uploadArtifacts: false
          temporaryPublicStorage: true
          configPath: './lighthouserc.json'
        continue-on-error: true

      - name: Check Lighthouse Scores
        run: |
          echo "Lighthouse reports have been generated and uploaded."
          echo "Review the reports in the temporary public storage link above."
          echo "This step allows the workflow to succeed while still providing visibility into quality metrics."
